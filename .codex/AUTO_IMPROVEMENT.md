# Codex Автоматическое Улучшение Кода

## Обзор

Система автоматически улучшает код и исправляет баги:
- ✅ Автоматический запуск после любых изменений кода
- ✅ Обнаружение и исправление runtime ошибок из эксплуатации
- ✅ Работа только в директории bot_hnushka
- ✅ Тестирование бота на каждой итерации

## Автоматические триггеры

### 1. После коммита (post-commit hook)
При каждом `git commit` автоматически запускается Codex:
```bash
git commit -m "your changes"
# Codex автоматически запустится в фоне
```

### 2. После merge/pull (post-merge hook)
При каждом `git pull` или `git merge` автоматически запускается Codex:
```bash
git pull
# Codex автоматически запустится в фоне
```

### 3. Мониторинг runtime ошибок
Скрипт `.codex/monitor_bot.sh` проверяет `bot.log` на ошибки:
```bash
# Запустить мониторинг (можно добавить в cron)
./.codex/monitor_bot.sh
```

## Приоритеты исправления

1. **Runtime ошибки** (высший приоритет)
   - Ошибки из `bot.log`
   - Ошибки из эксплуатации
   - Критические ошибки

2. **Статический анализ**
   - Синтаксические ошибки
   - Импорты
   - Типы

3. **Улучшения качества**
   - Рефакторинг
   - Оптимизация
   - Комментарии

## Рабочая директория

**ВАЖНО:** Codex работает ТОЛЬКО в `bot_hnushka` и дочерних директориях:
- ✅ `/root/bot_hnushka/`
- ✅ `/root/bot_hnushka/bot/`
- ✅ `/root/bot_hnushka/.codex/`
- ❌ НЕ работает вне bot_hnushka

## Runtime ошибки

Система автоматически обнаруживает ошибки в `bot.log`:
- `error`, `exception`, `traceback`
- `failed`, `critical`, `fatal`

При обнаружении:
1. Ошибки логируются в `.codex/errors.log`
2. Codex автоматически запускается для исправления
3. Исправления тестируются
4. Результаты сохраняются в память

## Ручной запуск

```bash
cd /root/bot_hnushka
./.codex/run_codex.sh
```

## Мониторинг

### Проверка логов
```bash
# Логи Codex после коммита
tail -f .codex/post_commit.log

# Логи Codex после merge
tail -f .codex/post_merge.log

# Логи исправления ошибок
tail -f .codex/monitor_fix.log

# История ошибок
cat .codex/errors.log

# Результаты тестов
cat .codex/test_log.txt
```

### Настройка cron для мониторинга
```bash
# Добавить в crontab (проверка каждые 5 минут)
*/5 * * * * /root/bot_hnushka/.codex/monitor_bot.sh
```

## Что исправляется

### Runtime ошибки (приоритет 1)
- Ошибки из bot.log
- Необработанные исключения
- Критические сбои
- Ошибки инициализации

### Статические проблемы (приоритет 2)
- Синтаксические ошибки
- Ошибки импорта
- Проблемы с типами
- Неиспользуемый код

### Качество кода (приоритет 3)
- Рефакторинг
- Оптимизация производительности
- Улучшение читаемости
- Добавление комментариев

## Ограничения

- Работает только в bot_hnushka
- Не изменяет файлы вне проекта
- Не удаляет рабочую функциональность
- Сохраняет историю исправлений

## Отключение автоматического запуска

Если нужно отключить автоматический запуск:
```bash
# Удалить hooks
rm .git/hooks/post-commit
rm .git/hooks/post-merge

# Или сделать неисполняемыми
chmod -x .git/hooks/post-commit
chmod -x .git/hooks/post-merge
```

## Проверка работы

```bash
# Проверить что hooks установлены
ls -la .git/hooks/post-*

# Проверить последние исправления
git log --grep="fix\|refactor" --oneline -10

# Проверить память итераций
cat .codex/memory.md
```

